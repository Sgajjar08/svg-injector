!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.SVGInjector=e()}(this,function(){"use strict";var G="http://www.w3.org/1999/xlink";var j=Array.prototype.forEach||function(t,e){if(null==this||"function"!=typeof t)throw new TypeError;var r,n=this.length>>>0;for(r=0;r<n;++r)r in this&&t.call(e,this[r],r,this)},o={},T=0,M=[],a=[],V={},l=function(t){return t.cloneNode(!0)},e=function(t,e){a[t]=a[t]||[],a[t].push(e)},n=function(t,r){var n="file:"===window.location.protocol;if(void 0!==o[t])o[t]instanceof SVGSVGElement?r(l(o[t])):e(t,r);else{if(!window.XMLHttpRequest)return r("Browser does not support XMLHttpRequest"),!1;o[t]={},e(t,r);var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState){if(404===i.status||null===i.responseXML)return r("Unable to load SVG file: "+t),n&&r("Note: SVG injection ajax calls do not work locally without adjusting security setting in your browser. Or consider using a local webserver."),r(),!1;if(!(200===i.status||n&&0===i.status))return r("There was a problem injecting the SVG: "+i.status+" "+i.statusText),!1;if(i.responseXML instanceof Document)o[t]=i.responseXML.documentElement;else if(DOMParser&&DOMParser instanceof Function){var e;try{e=(new DOMParser).parseFromString(i.responseText,"text/xml")}catch(t){e=void 0}if(!e||e.getElementsByTagName("parsererror").length)return r("Unable to parse SVG file: "+t),!1;o[t]=e.documentElement}!function(e){for(var t=0,r=a[e].length;t<r;t++)!function(t){setTimeout(function(){a[e][t](l(o[e]))},0)}(t)}(t)}},i.open("GET",t),i.overrideMimeType&&i.overrideMimeType("text/xml"),i.send()}},s=function(A,S,t,x){var e=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),k=A.getAttribute("data-src")||A.getAttribute("src");if(/\.svg/i.test(k))if(e)-1===M.indexOf(A)&&(M.push(A),A.setAttribute("src",""),n(k,function(c){if(void 0===c||"string"==typeof c)return x(c),!1;var t=A.getAttribute("id");t&&c.setAttribute("id",t);var e=A.getAttribute("title");e&&c.setAttribute("title",e);var r=[].concat(c.getAttribute("class")||[],"injected-svg",A.getAttribute("class")||[]).join(" ");c.setAttribute("class",function(t){for(var e={},r=(t=t.split(" ")).length,n=[];r--;)e.hasOwnProperty(t[r])||(e[t[r]]=1,n.unshift(t[r]));return n.join(" ")}(r));var n=A.getAttribute("style");n&&c.setAttribute("style",n);var i=[].filter.call(A.attributes,function(t){return/^data-\w[\w\-]*$/.test(t.name)});j.call(i,function(t){t.name&&t.value&&c.setAttribute(t.name,t.value)});var f,p,d,h,g,v={clipPath:["clip-path"],"color-profile":["color-profile"],cursor:["cursor"],filter:["filter"],linearGradient:["fill","stroke"],marker:["marker","marker-start","marker-mid","marker-end"],mask:["mask"],pattern:["fill","stroke"],radialGradient:["fill","stroke"]};Object.keys(v).forEach(function(t){d=v[f=t];for(var e=0,r=(p=c.querySelectorAll("defs "+f+"[id]")).length;e<r;e++){var n;h=p[e].id,g=h+"-"+T,j.call(d,function(t){for(var e=0,r=(n=c.querySelectorAll("["+t+'*="'+h+'"]')).length;e<r;e++)n[e].setAttribute(t,"url(#"+g+")")});for(var i=c.querySelectorAll("[*|href]"),o=[],a=0,l=i.length;a<l;a++)i[a].getAttributeNS(G,"href").toString()==="#"+p[e].id&&o.push(i[a]);for(var s=0,u=o.length;s<u;s++)o[s].setAttributeNS(G,"href","#"+g);p[e].id=g}}),c.removeAttribute("xmlns:a");for(var o,a,l=c.querySelectorAll("script"),s=[],u=0,m=l.length;u<m;u++)(a=l[u].getAttribute("type"))&&"application/ecmascript"!==a&&"application/javascript"!==a||(o=l[u].innerText||l[u].textContent,s.push(o),c.removeChild(l[u]));if(0<s.length&&("always"===S||"once"===S&&!V[k])){for(var w=0,b=s.length;w<b;w++)new Function(s[w])(window);V[k]=!0}var y=c.querySelectorAll("style");j.call(y,function(t){t.textContent+=""}),c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("xmlns:xlink",G),A.parentNode.replaceChild(c,A),delete M[M.indexOf(A)],A=null,T++,x(c)}));else{var r=A.getAttribute("data-fallback")||A.getAttribute("data-png");r?(A.setAttribute("src",r),x(null)):t?(A.setAttribute("src",t+"/"+k.split("/").pop().replace(".svg",".png")),x(null)):x("This browser does not support SVG and no PNG fallback was defined.")}else x("Attempted to inject a file with a non-svg extension: "+k)};return function(e,t,r){var n=(t=t||{}).evalScripts||"always",i=t.pngFallback||!1,o=t.each;if(void 0!==e.length){var a=0;j.call(e,function(t){s(t,n,i,function(t){o&&"function"==typeof o&&o(t),r&&e.length===++a&&r(a)})})}else e?s(e,n,i,function(t){o&&"function"==typeof o&&o(t),r&&r(1),e=null}):r&&r(0)}});
